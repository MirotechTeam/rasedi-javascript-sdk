"use strict";var D=Object.create;var A=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var C=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var _=(t,e)=>{for(var r in e)A(t,r,{get:e[r],enumerable:!0})},E=(t,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of k(e))!L.call(t,o)&&o!==r&&A(t,o,{get:()=>e[o],enumerable:!(a=N(e,o))||a.enumerable});return t};var h=(t,e,r)=>(r=t!=null?D(C(t)):{},E(e||!t||!t.__esModule?A(r,"default",{value:t,enumerable:!0}):r,t)),U=t=>E(A({},"__esModule",{value:!0}),t);var w={};_(w,{Gateway:()=>I,PaymentStatus:()=>f,RasediClient:()=>l});module.exports=U(w);var I=(s=>(s.FIB="FIB",s.ZAIN="ZAIN",s.ASIA_PAY="ASIA_PAY",s.FAST_PAY="FAST_PAY",s.NASS_WALLET="NASS_WALLET",s.CREDIT_CARD="CREDIT_CARD",s))(I||{}),f=(i=>(i.TIMED_OUT="TIMED_OUT",i.PENDING="PENDING",i.PAID="PAID",i.CANCELED="CANCELED",i.FAILED="FAILED",i))(f||{});var T=h(require("axios"));var m=h(require("node-forge")),R=require("elliptic"),u=h(require("@noble/ed25519")),c=require("buffer"),v=require("@noble/hashes/sha2.js");u.etc.sha512Sync=(...t)=>(0,v.sha512)(u.etc.concatBytes(...t));var d=class{constructor(e,r){this.privateKeyPem=e;this.keyId=r}getKeyId(){return this.keyId}async makeSignature(e,r){let a=`${e} || ${this.keyId} || ${r}`,o=c.Buffer.from(a,"utf8");try{if(this.privateKeyPem.includes("RSA PRIVATE KEY")){let i=m.default.pki.privateKeyFromPem(this.privateKeyPem),s=m.default.md.sha256.create();s.update(a,"utf8");let y=i.sign(s);return m.default.util.encode64(y)}}catch{}if(this.privateKeyPem.includes("EC PRIVATE KEY")||this.privateKeyPem.includes("BEGIN PRIVATE KEY"))try{let i=this.privateKeyPem.replace(/-----BEGIN PRIVATE KEY-----/g,"").replace(/-----END PRIVATE KEY-----/g,"").replace(/\s+/g,""),s=c.Buffer.from(i,"base64");if(s.length>16&&s[9]===43&&s[10]===101&&s[11]===112){let b=s.subarray(s.length-32);try{let P=new Uint8Array(o),B=await u.sign(P,b);return c.Buffer.from(B).toString("base64")}catch(P){throw P}}let y=m.default.pki.privateKeyFromPem(this.privateKeyPem),n=new R.ec("p256"),S=y.privateKey.toString(16),g=n.keyFromPrivate(S).sign(o),K=g.r.toArrayLike(c.Buffer,"be",32),x=g.s.toArrayLike(c.Buffer,"be",32);return c.Buffer.concat([K,x]).toString("base64")}catch{}throw new Error("Unsupported Key Format or Signing Error")}};var p=class p{constructor(e,r){this.privateKey=e;this.secretKey=r;this.auth=new d(e,r),this.isTest=r.includes("test"),this.httpClient=T.default.create({baseURL:p.API_BASE_URL,timeout:1e4,headers:{"Content-Type":"application/json"},validateStatus:()=>!0})}async call(e,r,a){let o=this.isTest?"test":"live",i=`/v${p.UPSTREAM_VERSION}/payment/rest/${o}${e}`,y={"x-signature":await this.auth.makeSignature(r,i),"x-id":this.auth.getKeyId()};try{let n=await this.httpClient.request({url:i,method:r,data:a,headers:y});if(n.status<200||n.status>209)throw new Error(`Request failed with status ${n.status}: ${JSON.stringify(n.data)}`);return{body:n.data,headers:n.headers,statusCode:n.status}}catch(n){throw n}}async createPayment(e){return this.call("/create","POST",e)}async getPaymentByReference(e){return this.call(`/status/${e}`,"GET")}async cancelPayment(e){return this.call(`/cancel/${e}`,"PATCH")}async verify(e){throw new Error("Verification not implemented for client-side SDK due to security risks of exposing public keys or logic.")}};p.API_BASE_URL="https://stage.api.rasedi.com",p.UPSTREAM_VERSION=1;var l=p;0&&(module.exports={Gateway,PaymentStatus,RasediClient});
//# sourceMappingURL=index.js.map