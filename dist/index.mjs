var R=(e=>(e.FIB="FIB",e.ZAIN="ZAIN",e.ASIA_PAY="ASIA_PAY",e.FAST_PAY="FAST_PAY",e.NASS_WALLET="NASS_WALLET",e.CREDIT_CARD="CREDIT_CARD",e))(R||{}),v=(t=>(t.TIMED_OUT="TIMED_OUT",t.PENDING="PENDING",t.PAID="PAID",t.CANCELED="CANCELED",t.FAILED="FAILED",t))(v||{});import K from"axios";import m from"node-forge";import{ec as T}from"elliptic";import*as c from"@noble/ed25519";import{Buffer as n}from"buffer";import{sha512 as S}from"@noble/hashes/sha2.js";c.etc.sha512Sync=(...d)=>S(c.etc.concatBytes(...d));var u=class{constructor(r,i){this.privateKeyPem=r;this.keyId=i}getKeyId(){return this.keyId}async makeSignature(r,i){let p=`${r} || ${this.keyId} || ${i}`,y=n.from(p,"utf8");try{if(this.privateKeyPem.includes("RSA PRIVATE KEY")){let t=m.pki.privateKeyFromPem(this.privateKeyPem),e=m.md.sha256.create();e.update(p,"utf8");let a=t.sign(e);return m.util.encode64(a)}}catch{}if(this.privateKeyPem.includes("EC PRIVATE KEY")||this.privateKeyPem.includes("BEGIN PRIVATE KEY"))try{let t=this.privateKeyPem.replace(/-----BEGIN PRIVATE KEY-----/g,"").replace(/-----END PRIVATE KEY-----/g,"").replace(/\s+/g,""),e=n.from(t,"base64");if(e.length>16&&e[9]===43&&e[10]===101&&e[11]===112){let I=e.subarray(e.length-32);try{let A=new Uint8Array(y),f=await c.sign(A,I);return n.from(f).toString("base64")}catch(A){throw A}}let a=m.pki.privateKeyFromPem(this.privateKeyPem),s=new T("p256"),l=a.privateKey.toString(16),P=s.keyFromPrivate(l).sign(y),g=P.r.toArrayLike(n,"be",32),E=P.s.toArrayLike(n,"be",32);return n.concat([g,E]).toString("base64")}catch{}throw new Error("Unsupported Key Format or Signing Error")}};var o=class o{constructor(r,i){this.privateKey=r;this.secretKey=i;this.auth=new u(r,i),this.isTest=i.includes("test"),this.httpClient=K.create({baseURL:o.API_BASE_URL,timeout:1e4,headers:{"Content-Type":"application/json"},validateStatus:()=>!0})}async call(r,i,p){let y=this.isTest?"test":"live",t=`/v${o.UPSTREAM_VERSION}/payment/rest/${y}${r}`,a={"x-signature":await this.auth.makeSignature(i,t),"x-id":this.auth.getKeyId()};try{let s=await this.httpClient.request({url:t,method:i,data:p,headers:a});if(s.status<200||s.status>209)throw new Error(`Request failed with status ${s.status}: ${JSON.stringify(s.data)}`);return{body:s.data,headers:s.headers,statusCode:s.status}}catch(s){throw s}}async createPayment(r){return this.call("/create","POST",r)}async getPaymentByReference(r){return this.call(`/status/${r}`,"GET")}async cancelPayment(r){return this.call(`/cancel/${r}`,"PATCH")}async verify(r){throw new Error("Verification not implemented for client-side SDK due to security risks of exposing public keys or logic.")}};o.API_BASE_URL="https://stage.api.rasedi.com",o.UPSTREAM_VERSION=1;var h=o;export{R as Gateway,v as PaymentStatus,h as RasediClient};
//# sourceMappingURL=index.mjs.map